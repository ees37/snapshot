var servo = require('servo-control/servo-control.js');
var shell = require('shelljs')

var TIME_TO_MOVE = 4000;

module.exports = {
  snapImage: function(callback)
  {
    console.log("snapping image");
    // return both motors to the home position
    servo.returnHome(servo.motorHorizontal_, function() {

    });
    servo.returnHome(servo.motorVertical_, function() {

    });

    // assume both motors are in the home position
    var posHor = servo.motorVertical_.HOME;
    var posVer = servo.motorHorizontal_.HOME;
    // schedule all of the movements
    var snapshots = [];
    for (i = 0; i < servo.TOTAL_DEGREES / servo.motorHorizontal_.DEG_PER_IMG; ++i) {
      var degree = i * servo.ONE_DEGREE * servo.motorHorizontal_.DEG_PER_IMG;
      setTimeout(servo.moveMotor, i * TIME_TO_MOVE, servo.motorHorizontal_,
            degree,
            function() {
              capture("shot" + i + ".jpg");
              snapshots.push("shot" + i + ".jpg");
      });
    }
    return snapshots;
  }
}

function capture(path)
{
  console.log("taking snapshot!");
  shell.exec("fswebcam -r 640x480 --jpeg 100 -D 1 " + path)
}
